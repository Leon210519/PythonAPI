<!DOCTYPE html>
<!-- Main dashboard shown after login with navigation to all features -->
<html lang="{{ get_locale() }}">
<head>
    <meta charset="UTF-8" />
    <title>{{ _("Enzyklop√§die üåê - Dashboard") }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body.light-mode {
            background-color: #f8f9fa;
            color: #000;
        }

        body.dark-mode {
            background-color: #121212;
            color: #fff;
        }

        .card-custom {
            border-radius: 12px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .dark-mode .card-custom {
            background-color: #1e1e1e;
            color: #fff;
            box-shadow: 0 6px 16px rgba(255, 255, 255, 0.05);
        }

        .card-custom:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #007bff;
        }

        .dark-mode .icon {
            color: #66b2ff;
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .lang-select,
        .toggle-darkmode {
            margin-left: 10px;
        }
    </style>
    <style>
@media (max-width: 768px) {
    .navbar {
        padding: 0.5rem;
    }
    
    .navbar-brand {
        font-size: 1.2rem;
    }
    
    .lang-select,
    .toggle-darkmode {
        margin: 0.5rem 0;
    }
    
    .container {
        padding: 0 1rem;
    }
}
</style>
</head>
<body class="light-mode">

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary px-4">
    <a class="navbar-brand" href="#">{{ _("Enzyklop√§die üåê") }}</a>

    <!-- Language Selector -->
    <div class="lang-select">
        <!-- F√ºr den Sprachauswahl-Select -->
<select class="form-select" id="languageSelector" onchange="changeLanguage()" aria-label="{{ _('Select language') }}">
            <option value="en" {% if get_locale() == 'en' %}selected{% endif %}>English</option>
            <option value="de" {% if get_locale() == 'de' %}selected{% endif %}>Deutsch</option>
        </select>
    </div>

    <!-- Search -->
    <form class="d-flex mx-auto" role="search">
        <input class="form-control me-2" type="search" placeholder="{{ _('Search...') }}" />
        <button class="btn btn-light" type="submit">{{ _('Search') }}</button>
    </form>

    <!-- Right-side buttons -->
    <div class="d-flex ms-auto align-items-center">
        <!-- F√ºr den Dark Mode Button -->
<button class="btn btn-outline-light toggle-darkmode" onclick="toggleDarkMode()" aria-label="{{ _('Toggle dark mode') }}">üåì</button>
        <a href="{{ url_for('logout') }}" class="btn btn-danger ms-2">{{ _('Logout') }}</a>
    </div>
</nav>

<!-- Nach der Navbar -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show m-3" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}
<!-- Dashboard Content -->
<div class="container mt-5">
    <h2 class="mb-4 text-center">
        üëã {{ _("Welcome") }} <span class="text-primary">{{ username }}</span>
    </h2>

    <p class="text-center text-muted">{{ _("Number of visits:") }} <span id="visitCount">0</span></p>

    <div class="row g-4">
        <!-- Currency -->
        <div class="col-md-4">
            <div class="card card-custom p-4 text-center">
                <div class="icon">üí±</div>
                <h5>{{ _("Currency") }}</h5>
                <p>{{ _("Check the latest exchange rates from global currencies.") }}</p>
                <a href="{{ url_for('show_currencies') }}" class="btn btn-outline-primary w-100">{{ _("Go") }}</a>
            </div>
        </div>

        <!-- Weather -->
        <div class="col-md-4">
            <div class="card card-custom p-4 text-center">
                <div class="icon">üå¶Ô∏è</div>
                <h5>{{ _("Weather") }}</h5>
                <p>{{ _("Check weather forecast for any city worldwide.") }}</p>
                <a href="{{ url_for('show_weather') }}" class="btn btn-outline-primary w-100">{{ _("Go") }}</a>
            </div>
        </div>

        <!-- News -->
        <div class="col-md-4">
            <div class="card card-custom p-4 text-center">
                <div class="icon">üì∞</div>
                <h5>{{ _("News") }}</h5>
                <p>{{ _("Get the latest news headlines updated live.") }}</p>
                <a href="{{ url_for('show_news') }}" class="btn btn-outline-primary w-100">{{ _("Go") }}</a>
            </div>
        </div>
    </div>
</div>

<script>
    // Prevent dark mode flash
    const savedTheme = localStorage.getItem("theme");
    if (savedTheme) {
        document.documentElement.classList.add(savedTheme);
    }
</script>

<script>
    // Count visits (sicherer)
    const visitCountElement = document.getElementById("visitCount");
    let visits = 0;
    try {
        visits = parseInt(localStorage.getItem("dashboardVisits")) || 0;
        visits = Math.min(visits + 1, 999999); // Limit setzen
        localStorage.setItem("dashboardVisits", visits);
    } catch (e) {
        console.error("Error accessing localStorage:", e);
    }
    visitCountElement.textContent = visits;

    // Dark mode toggle
    function toggleDarkMode() {
        const body = document.body;
        const isDarkMode = body.classList.contains("dark-mode");
        const newMode = isDarkMode ? "light-mode" : "dark-mode";
        
        body.classList.remove(isDarkMode ? "dark-mode" : "light-mode");
        body.classList.add(newMode);
        
        try {
            localStorage.setItem("theme", newMode);
        } catch (e) {
            console.error("Error saving theme:", e);
        }
    }

    // Load theme on startup
    window.onload = function () {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme) {
            document.body.className = savedTheme;
        }
    }

    // Language selector to change language via backend route
    function changeLanguage() {
        const selectedLang = document.getElementById("languageSelector").value;
        window.location.href = '/set_language/' + selectedLang;
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
